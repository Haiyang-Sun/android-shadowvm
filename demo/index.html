<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Demo Android ShadowVM</title>
		<script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
		<script type="text/javascript" src="js/bootstrap.js"></script>
		<script type="text/javascript" src="google-code-prettify/run_prettify.js"></script>
		<script type="text/javascript" src="google-code-prettify/prettify.js"></script>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
		<link rel="stylesheet" type="text/css" href="google-code-prettify/prettify.css">
		<link rel="stylesheet" type="text/css" href="css/prettify.css">
		<script>
		$.ajax({
			url:"data/bc0.java",  
			success:function(data) {
				$("#bc_code0").html(data); 
			}
		});
		$.ajax({
			url:"data/bc1.java",  
			success:function(data) {
				$("#bc_code1").html(data); 
			}
		});
		$.ajax({
			url:"data/network0.java",  
			success:function(data) {
				$("#net_code0").html(data); 
			}
		});
		$.ajax({
			url:"data/network1.java",  
			success:function(data) {
				$("#net_code1").html(data); 
			}
		});
		$.ajax({
			url:"data/permission0.java",  
			success:function(data) {
				$("#permission_code0").html(data); 
			}
		});
		$.ajax({
			url:"data/permission1.java",  
			success:function(data) {
				$("#permission_code1").html(data); 
			}
		});
		$.ajax({
			url:"data/callstack0.java",  
			success:function(data) {
				$("#callstack_code0").html(data); 
			}
		});
		$.ajax({
			url:"data/callstack1.java",  
			success:function(data) {
				$("#callstack_code1").html(data); 
			}
		});
		$.ajax({
			url:"data/callstack2.java",  
			success:function(data) {
				$("#callstack_code2").html(data); 
			}
		});
		$.ajax({
			url:"data/svm.prop",  
			success:function(data) {
				$("#config_code1").html(data); 
			}
		});

		function update_callstack(option){
			if(option == 0)
				$("#code_callstack0").show();
			else
				$("#code_callstack0").hide();
			if(option == 1)
				$("#code_callstack1").show();
			else
				$("#code_callstack1").hide();
			if(option == 2)
				$("#code_callstack2").show();
			else
				$("#code_callstack2").hide();
		}

		function update_bc(bc_option){
			if(bc_option == 0)
				$("#code_bc0").show();
			else
				$("#code_bc0").hide();
			if(bc_option == 1)
				$("#code_bc1").show();
			else
				$("#code_bc1").hide();
			if(bc_option == 2) {
				$("#bc_single").show();
				loopback_bc();
			} else {
				$("#bc_single").hide();
			}
			if(bc_option == 3) {
				$("#bc_overall").show();
				loopback_bc();
			} else {
				$("#bc_overall").hide();
			}
		}
		function update_net(net_option){
			if(net_option == 0)
				$("#code_net0").show();
			else
				$("#code_net0").hide();
			if(net_option == 1)
				$("#code_net1").show();
			else
				$("#code_net1").hide();
			if(net_option == 2) {
				$("#network_table").show();
				loopback_net();
			} else {
				$("#network_table").hide();
			}
		}
		function update_permission(permission_option){
			if(permission_option == 0)
				$("#code_permission0").show();
			else
				$("#code_permission0").hide();
			if(permission_option == 1)
				$("#code_permission1").show();
			else
				$("#code_permission1").hide();
			if(permission_option == 2) {
				$("#permission").show();
				loopback();
			} else {
				$("#permission").hide();
			}
		}

		function updatesingle(){
			$.ajax({
				url:"data/branch-takens.log",  
				cache: false,
				success:function(data) {
					$("#bc_single_table").html(data); 
				}
			});
		}

		function loopback_bc(){
			$.ajax({
				url:"data/branch-overall.log",  
				cache: false,
				success:function(data) {
					$("#bc_overall_table").html(data); 
				}
			});
			updatesingle();
		}

		function loopback_net(){
			$.ajax({
				url:"data/network.log",  
				cache: false,
				success:function(data) {
					$("#network_table").html(data); 
				}
			});
		}
		function loopback(){
			$.ajax({
				url:"data/permission.log",  
				cache: false,
				success:function(data) {
					var proc = $("#proc_list").find(":selected").text();
					var res = data;
					if(proc != "") { 
						res = "";
						var lines = data.split("\n");
						for (i = 0; i < lines.length; i += 1) {
							if(lines[i].indexOf(proc) > -1 || lines[i].indexOf("th") > -1) {
								res = res + lines[i] +'\n';
							}
						}
					}
					$("#permission_table").html(res); 
				}
			});
		}

		function setPacket(str){
			$("#packetContent").html(str);
		}

		function onBodyLoad(){
			update_bc(-1);
			update_net(-1);
			update_permission(-1);
			update_callstack(-1);
			setInterval(loopback_bc, 3000);
			setInterval(loopback_net, 3000);
			setInterval(loopback, 5000);
		}

		</script>
	</head>
	<body onload="onBodyLoad()">
		<div class = "container" id = "navigator">
			<center><h1>Demos for Android ShadowVM</h1></center>
		</div>
		<div class = "container" id = "body">
			<ul class="nav nav-tabs" role="tablist">
				<li role="presentation" class="active">
					<a href="#bc-tab" aria-controls="bc-tab" role="tab" data-toggle="tab">Branch Coverage</a>
				</li>
				<li role="presentation">
					<a href="#net-tab" aria-controls="net-tab" role="tab" data-toggle="tab">Network track</a>
				</li>
				<li role="presentation">
					<a href="#permission-tab" aria-controls="permission-tab" role="tab" data-toggle="tab">Permission Usage</a>
				</li>
				<li role="presentation">
					<a href="#callstack-tab" aria-controls="callstack-tab" role="tab" data-toggle="tab">Call Stack Dump</a>
				</li>
				<li role="presentation">
					<a href="#config-tab" aria-controls="config-tab" role="tab" data-toggle="tab">Configuration</a>
				</li>
			</ul>
		<div class="tab-content">
			<div role="tabpanel" class="tab-pane fade in active" id="bc-tab">
			<div class = "col-md-3">
				<div id="bc">
					<h3><a href="#">Branch coverage</a></h2>
					<div id="bc-details">
						<ol>
							<li>
							<a href="#" onclick="update_bc(0)">instrumentation</a>
							</li>
							<li>
							<a href="#" onclick="update_bc(1)">analysis</a>
							</li>
							<li>
							<a href="#" onclick="update_bc(2)">token history</a>
							</li>
							<li>
							<a href="#" onclick="update_bc(3)">overall report</a>
							</li>
						</ol>
					</div>
				</div>
			</div>
			<div class = "col-md-9" id = "dashboard-bc">
				<div id = "code_bc0">
					<pre class="prettyprint" id = "bc_code0" style="font-size:10px">
					</pre>
				</div>
				<div id = "code_bc1">
					<pre class="prettyprint" id = "bc_code1" style="font-size:10px">
					</pre>
				</div>
				<div id = "bc_single">
					<table id = "bc_single_table" class="table table-condensed table-bordered table-striped" >
					</table>
				</div>
				<div id = "bc_overall">
					<table id="bc_overall_table" class="table table-condensed table-bordered table-striped" >
					</table>
				</div>
			</div>
			</div>
			<div role="tabpanel" class="tab-pane fade" id="net-tab">
			<div class = "col-md-3">
				<div id="net">
					<h3><a href="#">Network track</a></h2>
					<div id="net-details">
						<ol>
							<li>
							<a href="#" onclick="update_net(0)">instrumentation</a>
							</li>
							<li>
							<a href="#" onclick="update_net(1)">analysis</a>
							</li>
							<li>
							<a href="#" onclick="update_net(2)">report</a>
							</li>
						</ol>
					</div>
				</div>
			</div>
			<div class = "col-md-9" id = "dashboard-net">
				<div id = "code_net0">
					<?prettify lang=java?>
					<pre id="net_code0" style="font-size:10px">
					</pre>
				</div>
				<div id = "code_net1">
					<?prettify lang=java?>
					<pre id="net_code1" style="font-size:10px">
					</pre>
				</div>
				<div id = "network">
					<table class="table table-condensed table-bordered table-striped" id="network_table" >
					</table>
				</div>
			</div>
			</div>
			<div role="tabpanel" class="tab-pane fade" id="permission-tab">

			<div class = "col-md-3">
				<div id="permission_left">
					<h3><a href="#">Permissions</a></h2>
					<div id="permission-details">
						<ol>
							<li>
							<a href="#" onclick="update_permission(0)">instrumentation</a>
							</li>
							<li>
							<a href="#" onclick="update_permission(1)">analysis</a>
							</li>
							<li>
							<a href="#" onclick="update_permission(2)">report</a>
							</li>
						</ol>
					</div>
				</div>
			</div>
			<div class = "col-md-9" id = "dashboard-permission">
				<div id = "code_permission0">
					<?prettify lang=java?>
					<pre style="font-size:10px" id="permission_code0">
					</pre>
				</div>
				<div id = "code_permission1">
					<?prettify lang=java?>
					<pre style="font-size:10px" id="permission_code1">
					</pre>
				</div>
				<div id = "permission">
					<span>Filter by </span><select class="form-control input" id="proc_list" onchange="loopback()">
						<option></option>
						<option>pixelrush.xphonefree</option>
						<option>ch.usi.dag.android.example</option>
						<option>com.android.phone</option>
					</select>
					<table class="table table-condensed table-bordered table-striped" id="permission_table" >
					</table>
				</div>
			</div>
		</div>
		<div role="tabpanel" class="tab-pane fade" id="callstack-tab">
			<div class = "col-md-3">
				<div id="callstack">
					<h3><a href="#">Call stack dump</a></h2>
					<div id="config-details">
						<ol>
							<li>
							<a href="#" onclick=update_callstack(0)>instrument method body</a>
							</li>
							<li>
							<a href="#" onclick=update_callstack(1)>instrument for each invocation</a>
							</li>
							<li>
							<a href="#" onclick=update_callstack(2)>analysis</a>
							</li>
						</ol>
					</div>
				</div>
			</div>
			<div class = "col-md-9" id = "dashboard-callstack">
				<div id = "code_callstack0">
					<pre id="callstack_code0" style="font-size:10px">
					</pre>
				</div>
				<div id = "code_callstack1">
					<pre id="callstack_code1" style="font-size:10px">
					</pre>
				</div>
				<div id = "code_callstack2">
					<pre id="callstack_code2" style="font-size:10px">
					</pre>
				</div>
			</div>
		</div>
		<div role="tabpanel" class="tab-pane fade" id="config-tab">
			<div class = "col-md-3">
				<div id="config">
					<h3><a href="#">Configuration</a></h2>
					<div id="config-details">
						<ol>
							<li>
							<a href="data/config.xml">Server side</a>
							</li>
							<li>
							<a href="#">Android side</a>
							</li>
						</ol>
					</div>
				</div>
			</div>
			<div class = "col-md-9" id = "dashboard-config">
				<div id = "code_config1">
					<pre id="config_code1" style="font-size:12px">
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="stack" tabindex="-1" role="dialog" aria-labelledby="packetLabel">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				</div>
				<div class="modal-body" id="callstack">
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="packet" tabindex="-1" role="dialog" aria-labelledby="packetLabel">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				</div>
				<div class="modal-body" id="packetContent">
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>
</body>
</html>
